---
import Contact from "@/components/Contact.astro";
import Button from "@/components/ui/astro/Button.astro";
import Projects from "@/components/Projects.astro";
import Socials from "@/components/Socials.astro";
import MainLayout from "@/layouts/main.astro";
import FolderKanban from "@lucide/astro/icons/folder-kanban";
import Share2 from "@lucide/astro/icons/share-2";
import Mail from "@lucide/astro/icons/mail";
import { siteConfig } from "@/config/site";
import type { Language } from "@/i18n/config";
import { defaultLanguage, getDictionary } from "@/i18n/config";
import { getProjects } from "@/data/projects";
import { getSocials } from "@/data/socials";
import { buildSoftwareSourceCodeJsonLd } from "@/lib/seo";

const lang: Language = defaultLanguage;
const dict = getDictionary(lang);
const projects = getProjects(lang);
const socials = getSocials(lang);
const pathname = Astro.url.pathname;
const jsonLd = buildSoftwareSourceCodeJsonLd(
  projects,
  siteConfig.siteUrl,
  siteConfig.person.fullName || siteConfig.author
);

const footerRaw = dict["footer_copy_html"] || dict["footer_copy"] || "";
const footerHtml = footerRaw
  .replace(/<a1>/g, `<a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer">`)
  .replace(/<\/a1>/g, "</a>")
  .replace(/<a2>/g, `<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener noreferrer">`)
  .replace(/<\/a2>/g, "</a>");

const navSocial = siteConfig.social || {};
const logo = "/images/logo-mick-schroeder.svg";
---

<MainLayout lang={lang} dict={dict} pathname={pathname} jsonLd={jsonLd}>
  <section class="mb-6 text-center text-foreground">
    <div
      class="relative mx-auto aspect-[1150/150] w-full max-w-[18rem] md:max-w-[22rem]"
      style={`mask-image: url(${logo}); -webkit-mask-image: url(${logo}); mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-size: contain; -webkit-mask-size: contain; mask-position: center; -webkit-mask-position: center;`}
    >
      <span aria-hidden class="absolute inset-0 block rounded-sm bg-[var(--foreground)]" />
      <img src={logo} alt="Mick Schroeder" class="sr-only" loading="eager" decoding="async" />
    </div>
    <h1 class="sr-only">Mick Schroeder</h1>
  </section>

  <div class="relative mb-10 overflow-hidden rounded-2xl hero-gradient p-6 text-center ring-1 ring-emerald-500 dark:ring-emerald-800 md:p-10">
    <div aria-hidden class="pointer-events-none absolute inset-0">
      <div class="animate-drift-slow absolute left-1/2 top-[-30%] h-60 w-60 -translate-x-1/2 rounded-full bg-lime-500/15 blur-3xl" />
      <div class="animate-drift-slower absolute -left-6 bottom-[-10%] h-48 w-48 rounded-full bg-emerald-500/15 blur-3xl" />
      <div class="animate-glow absolute right-[-8%] top-[-12%] h-56 w-56 rotate-6 rounded-full bg-teal-500/14 blur-3xl" />
      <div class="animate-shimmer absolute inset-x-8 top-0 h-px bg-[linear-gradient(90deg,transparent,rgba(190,242,100,0.7),transparent)]" />
    </div>
    <p class="relative z-10 text-xl text-muted-foreground md:px-10 animate-rise" style="animation-delay: 0.05s" set:html={dict["hero_line"]} />
    <p class="relative z-10 mt-3 text-sm text-emerald-100/90 md:text-base animate-rise" style="animation-delay: 0.15s">
      {dict["hero_sub_line"]}
    </p>
    <div class="relative z-10 mt-6 flex flex-col items-center justify-center gap-3 md:flex-row animate-rise" style="animation-delay: 0.25s">
      <Button href="#projects" size="lg" className="px-6 py-3 text-lg">
        {dict["cta_projects"]}
      </Button>
      <Button
        href="#contact"
        variant="outline"
        size="lg"
        className="px-6 py-3 text-lg"
      >
        {dict["cta_email"]}
      </Button>
    </div>
    <div class="relative z-10 mt-4 flex flex-wrap justify-center gap-4 text-sm font-medium text-emerald-50 animate-rise" style="animation-delay: 0.35s">
      {navSocial.linkedin && (
        <a
          href={`https://www.linkedin.com/in/${navSocial.linkedin}/`}
          target="_blank"
          rel="noopener noreferrer"
          class="text-card-foreground underline decoration-emerald-300 underline-offset-4 hover:text-emerald-100"
        >
          {dict["cta_linkedin"]}
        </a>
      )}
      {navSocial.github && (
        <a
          href={`https://github.com/${navSocial.github}`}
          target="_blank"
          rel="noopener noreferrer"
          class="text-card-foreground underline decoration-emerald-300 underline-offset-4 hover:text-emerald-100"
        >
          {dict["cta_github"]}
        </a>
      )}
    </div>
  </div>

  <section id="projects" class="mt-10 scroll-mt-32">
    <h2 class="animate-rise mb-4 flex items-center gap-2 text-2xl font-bold" style="animation-delay: 0.1s">
      <FolderKanban class="h-6 w-6 text-primary" aria-hidden="true" />
      {dict["projects_heading"]}
    </h2>
    <Projects projects={projects} />
  </section>

  <section id="socials" class="mt-10 scroll-mt-32">
    <h2 class="animate-rise mb-4 flex items-center gap-2 text-2xl font-bold" style="animation-delay: 0.1s">
      <Share2 class="h-6 w-6 text-primary" aria-hidden="true" />
      {dict["socials_heading"]}
    </h2>
    <Socials items={socials} dict={dict} />
  </section>

  <section id="contact" class="mt-10 scroll-mt-32">
    <h2 class="animate-rise mb-4 flex items-center gap-2 text-2xl font-bold" style="animation-delay: 0.1s">
      <Mail class="h-6 w-6 text-primary" aria-hidden="true" />
      {dict["contact_heading"]}
    </h2>
    <Contact email={siteConfig.social.email} dict={dict} />
  </section>

  <footer class="mt-12 text-center text-xs opacity-80">
    <p set:html={footerHtml} />
  </footer>
</MainLayout>
